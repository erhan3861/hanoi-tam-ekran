<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hanoi Kulesi Algoritma Oyunu</title>
<style>
:root {
  --bg:#0b0f26;
  --panel:#141a3f;
  --panel2:#192159;
  --ink:#eef0ff;
  --muted:#a9add6;
  --accent:#6c5dd3;
  --gold:#ffde59;
  --good:#2ecc71;
}
* { box-sizing:border-box }
html, body {
  height:100%;
  margin:0;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
  background:radial-gradient(1200px 800px at 10% -10%, rgba(108,93,211,.18), transparent 30%), var(--bg);
  color:var(--ink);
}
.wrap {
  width: 95%;
  max-width:1200px;
  margin:24px auto;
  padding:12px;
}
.wrap > h1 {
  text-align: center;
  margin-top: 0;
  margin-bottom: 16px;
  font-size: clamp(22px, 3vw, 32px);
}
.main-board {
  display: grid;
  grid-template-columns: 350px 1fr;
  gap: 20px;
  align-items: start;
}
.card {
  background:linear-gradient(180deg, var(--panel), var(--panel2));
  border:1px solid rgba(255,255,255,.07);
  border-radius:16px;
  box-shadow:0 12px 32px rgba(0,0,0,.35);
  padding: 20px;
}
.description-card h2 {
  margin-top: 5px;
  color: var(--gold);
}
.description-card p {
  color: var(--muted);
  line-height: 1.6;
  font-size: 15px;
}
.description-card hr {
    border: none;
    height: 1px;
    background-color: rgba(255, 255, 255, 0.1);
    margin: 24px 0;
}
.controls {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  gap: 16px;
}
.btn {
  background:linear-gradient(180deg, #273074, #1a1f55);
  border:1px solid rgba(255,255,255,.10);
  color:#fff;
  padding:10px 14px;
  border-radius:12px;
  cursor:pointer;
  font-weight:700;
  letter-spacing:.2px;
  box-shadow:0 8px 18px rgba(0,0,0,.25);
  transition:transform .05s, box-shadow .2s;
}
.btn:hover { box-shadow:0 12px 22px rgba(0,0,0,.35) }
.btn:active { transform:translateY(1px) }
.btn.acc { background:linear-gradient(180deg,var(--accent),#4e42c2) }
.btn.good { background:linear-gradient(180deg,#2f9b63,#177845) }

#fullscreenBtn {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 999;
    border-width: 2px;
}
#fullscreenBtn svg {
    width: 24px;
    height: 24px;
    fill: white;
}

label, .stat {
  color: var(--muted);
  font-size: 14px;
  font-weight: 500;
}
select {
  background:#0e1333;
  border:1px solid rgba(255,255,255,.12);
  color:#fff;
  border-radius:10px;
  padding:10px;
  font-weight: 700;
}
.game-area {
  text-align: center;
  padding: 10px;
  overflow-x: auto;
}
#canvas {
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px;
  max-width: 100%;
  height: auto;
}
/* Modal Styles */
.modal {
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(5,6,16,.65);
  backdrop-filter:blur(5px);
  z-index: 1000;
}
.modal.active { display:flex }
.modal .inner {
  background:linear-gradient(180deg, var(--panel), var(--panel2));
  border:1px solid rgba(255,255,255,.10);
  padding:28px;
  border-radius:16px;
  max-width:520px;
  text-align:center;
  box-shadow:0 16px 40px rgba(0,0,0,.4);
}
.modal h2 { margin-top: 0; font-size: 24px; }
.pass {
  font-size:24px;
  font-weight:900;
  color:var(--gold);
  letter-spacing:1px;
  text-shadow:0 0 10px rgba(255,222,89,.9), 0 0 18px rgba(108,93,211,.6);
  word-break: break-all;
}
.copyline {
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
  margin:16px 0;
  background: rgba(0,0,0,0.2);
  padding: 12px;
  border-radius: 12px;
}
/* Responsive Design */
@media (max-width: 960px) {
  .main-board {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<button id="fullscreenBtn" class="btn acc" title="Tam Ekran Modu">
    <svg id="icon-expand" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 2h-2v3h-3v2h5v-5zm-3-2V5h-2v5h5V7h-3z"/></svg>
    <svg id="icon-compress" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display:none;"><path d="M14 10h5v2h-5zM5 12h5v2H5zm9-7h5v2h-5zm-9 2h5v2H5zm12 5h2v5h-5v-2h3zm-2 2h-3v-2H5v5h5v-2h3z"/></svg>
</button>

<div class="wrap">
  <h1>Hanoi Kulesi Algoritma Oyunu</h1>
  <div class="main-board">
    <section class="card description-card">
      <h2>Açıklama & Kurallar</h2>
      <p>
        Hanoi Kuleleri, matematiksel bir bulmaca oyunudur. Amaç, soldaki kuleden başlayan tüm disk yığınını, kurallara uyarak en sağdaki kuleye taşımaktır.
      </p>
      <p><strong>Temel Kurallar:</strong></p>
      <ol>
        <li style="color: var(--muted); line-height: 1.6;">Her hamlede sadece bir disk taşıyabilirsiniz.</li>
        <li style="color: var(--muted); line-height: 1.6;">Büyük bir disk, asla daha küçük bir diskin üzerine konulamaz.</li>
        <li style="color: var(--muted); line-height: 1.6;">Diskleri taşımak için ortadaki yardımcı kuleyi kullanabilirsiniz.</li>
      </ol>
      
      <hr>

      <div class="controls">
        <label for="disks">Zorluk:</label>
        <select id="disks">
          <option value=4 selected>Kolay (4 Disk)</option>
          <option value=5>Normal (5 Disk)</option>
          <option value=6>Zor (6 Disk)</option>
          <option value=7>Çok Zor (7 Disk)</option>
        </select>
        <button id="newGameBtn" class="btn acc">🌀 Yeni Oyun</button>
        <div class="stat">Hamle: <b id="moves">0</b></div>
        <div class="stat">Min. Hamle: <b id="minMoves">15</b></div>
      </div>
    </section>

    <div id="game-column">
      <section class="card game-area">
        <canvas id="canvas"></canvas>
      </section>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal" role="dialog" aria-modal="true">
  <div class="inner">
    <h2>🎉 Tebrikler, Bulmaca Çözüldü!</h2>
    <p>Kuleyi başarıyla taşıdınız. İşte bu başarının ödülü:</p>
    <div class="copyline">
      <span class="pass" id="pwd">—</span>
      <button class="btn" id="copy">📋 Kopyala</button>
    </div>
    <button class="btn good" id="ok">Harika!</button>
  </div>
</div>

<script>
'use strict';

// --- GAME LOGIC (HANOI) ---
var canvas;
var ctx;
var CANVAS_HEIGHT = 400;
var CANVAS_WIDTH = 800;
var DISK_THICKNESS = 25;
var VIEW_ANGLE = 10;
var RAISE_HEIGHT = DISK_THICKNESS * 1.5;
var SPEED = 1.0;

var totalDisks = 4;
var pegX = [];
var pegs = [[], [], []];
var selectedDisk = undefined;
var lastCompletePeg = 0;
var moves = 0;

// --- DOM ELEMENTS ---
const movesEl = document.getElementById('moves');
const minMovesEl = document.getElementById('minMoves');
const newGameBtn = document.getElementById('newGameBtn');
const disksSelect = document.getElementById('disks');
const modal = document.getElementById('modal');
const pwdEl = document.getElementById('pwd');
const copyBtn = document.getElementById('copy');
const okBtn = document.getElementById('ok');
const fullscreenBtn = document.getElementById('fullscreenBtn');
const iconExpand = document.getElementById('icon-expand');
const iconCompress = document.getElementById('icon-compress');
const FIXED_PASSWORD = 'HANOI-MODERN-2025-BASARI-KODU-777';

// Start-up initialization code.
function init() {
  totalDisks = parseInt(disksSelect.value, 10);
  pegs = [[], [], []];
  selectedDisk = undefined;
  lastCompletePeg = 0;
  moves = 0;
  updateMoves();

  pegX = [];
  for (var i = 0; i < 3; i++) {
    pegX[i] = CANVAS_WIDTH / 3 * i + CANVAS_WIDTH / (3 * 2);
  }

  for (var i = totalDisks - 1; i >= 0; i--) {
    new Disk(i, totalDisks);
  }
  
  if (!canvas) {
      canvas = document.getElementById('canvas');
      canvas.addEventListener('click', onClick);
      document.addEventListener('keypress', onKeypress);
      ctx = canvas.getContext('2d');
      requestAnimationFrame(frame);
  }
  
  canvas.setAttribute('height', CANVAS_HEIGHT);
  canvas.setAttribute('width', CANVAS_WIDTH);
}

window.addEventListener('load', () => {
    init();
    newGameBtn.addEventListener('click', init);
    disksSelect.addEventListener('change', init);
    okBtn.addEventListener('click', () => modal.classList.remove('active'));
    modal.addEventListener('click', e => { if(e.target === modal) modal.classList.remove('active'); });
    copyBtn.addEventListener('click', handleCopy);
    fullscreenBtn.addEventListener('click', toggleFullscreen);
    document.addEventListener('fullscreenchange', updateFullscreenIcon);
});

var lastTime;

// Animation frame.
function frame(timestamp) {
  if(!ctx) return;
  var delta;
  if (lastTime === undefined) {
    delta = 0;
  } else {
    var elapsedTime = timestamp - lastTime;
    delta = elapsedTime ? elapsedTime / SPEED : 0;
  }
  lastTime = timestamp;
  canvas.width = canvas.width;
  ctx.translate(0, CANVAS_HEIGHT * 0.8);
  for (var i = 0; i < pegs.length; i++) {
    ctx.save();
    ctx.translate(pegX[i], 0);
    drawSpot();
    ctx.restore();
  }
  for (var i = 0; i < pegs.length; i++) {
    for (var j = 0; j < pegs[i].length; j++) {
      var disk = pegs[i][j];
      var pitchDegrees = VIEW_ANGLE;
      var deltaX = delta;
      if (disk.targetX > disk.x) {
        disk.x = Math.min(disk.x + deltaX, disk.targetX);
      } else if (disk.targetX < disk.x) {
        disk.x = Math.max(disk.x - deltaX, disk.targetX);
      }
      if (disk.sourceX === disk.targetX) {
        if (disk.targetY > disk.y) {
          disk.y = Math.min(disk.y + delta, disk.targetY);
        } else if (disk.targetY < disk.y) {
          disk.y = Math.max(disk.y - delta, disk.targetY);
        }
      } else {
        var distanceX = disk.targetX - disk.sourceX;
        var peakDenominator = 4;
        var y = computeParabolaY(disk.x, disk.sourceX, disk.sourceY, disk.sourceX + (distanceX / 2), (disk.targetY + disk.sourceY) / 2 + Math.abs(distanceX / peakDenominator), disk.targetX, disk.targetY);
        disk.y = y;
      }
      ctx.save();
      ctx.translate(disk.x, -disk.y);
      disk.drawDisk(pitchDegrees, 0);
      ctx.restore();
    }
  }
  requestAnimationFrame(frame);
}

function computeParabolaY(x, x1, y1, x2, y2, x3, y3) {
  var denom = (x1 - x2) * (x1 - x3) * (x2 - x3);
  var a = (x3 * (y2 - y1) + x2 * (y1 - y3) + x1 * (y3 - y2)) / denom;
  var b = (x3 * x3 * (y1 - y2) + x2 * x2 * (y3 - y1) + x1 * x1 * (y2 - y3)) / denom;
  var c = (x2 * x3 * (x2 - x3) * y1 + x3 * x1 * (x3 - x1) * y2 + x1 * x2 * (x1 - x2) * y3) / denom;
  return a * x * x + b * x + c;
}

function onClick(e) {
  var rect = canvas.getBoundingClientRect();
  var scaleX = canvas.width / rect.width;
  var offsetX = (e.clientX - rect.left) * scaleX;
  var third = Math.floor(offsetX / CANVAS_WIDTH * pegs.length);
  third = Math.min(pegs.length - 1, Math.max(0, third));
  input(third);
}

function onKeypress(e) {
  var third = Number(e.key);
  if (third > 0 && third <= pegs.length) {
    input(third - 1);
  }
}

function input(n) {
  var peg = pegs[n];
  if (selectedDisk) {
    var topDisk = peg[peg.length - 1];
    if (topDisk && (topDisk.n < selectedDisk.n)) {
      selectedDisk.isRaised = false;
      selectedDisk.setTarget();
      selectedDisk = undefined;
      return;
    }
    moves++;
    updateMoves();
    var oldPeg = pegs[selectedDisk.peg];
    oldPeg.pop();
    peg.push(selectedDisk);
    selectedDisk.peg = n;
    selectedDisk.isRaised = false;
    selectedDisk.setTarget();
    selectedDisk = undefined;
    checkWin();
  } else {
    selectedDisk = peg[peg.length - 1];
    if (selectedDisk) {
      selectedDisk.isRaised = true;
      selectedDisk.setTarget();
    }
  }
}

function updateMoves() {
    movesEl.textContent = moves;
    minMovesEl.textContent = Math.pow(2, totalDisks) - 1;
}

function checkWin() {
  for (var i = 1; i < pegs.length; i++) {
    if (pegs[i].length === totalDisks) {
      lastCompletePeg = i;
      setTimeout(function() {
        pwdEl.textContent = FIXED_PASSWORD;
        modal.classList.add('active');
      }, 500);
      return;
    }
  }
}

function Disk(n, total) {
  this.n = n;
  var maxRadius = CANVAS_WIDTH / 7;
  var minRadius = maxRadius / 8;
  this.radius = (maxRadius - minRadius) / (total + 1) * (n + 1) + minRadius;
  this.peg = 0;
  this.isRaised = false;
  this.x = undefined; this.y = undefined;
  this.targetX = undefined; this.targetY = undefined;
  this.sourceX = undefined; this.sourceY = undefined;
  if (n === 0) { this.fillColour = '#F0A609'; this.strokeColour = '#A37106'; }
  else if (n % 2) { this.fillColour = '#178F47'; this.strokeColour = '#0E5B2D'; }
  else { this.fillColour = '#2E5FFF'; this.strokeColour = '#1B3899'; }
  pegs[this.peg].push(this);
  this.setTarget();
}

Disk.prototype.drawDisk = function(pitchDegrees) {
  var pitchRadians = pitchDegrees / 180 * Math.PI;
  ctx.fillStyle = this.fillColour;
  ctx.strokeStyle = this.strokeColour;
  ctx.lineWidth = 1;
  var radius = this.radius;
  var ratio = Math.sin(pitchRadians);
  var height = Math.abs(radius * ratio);
  var halfVisualThickness = Math.cos(pitchRadians) * ((DISK_THICKNESS - 1) / 2);
  var topY = -halfVisualThickness;
  var bottomY = halfVisualThickness;
  ctx.beginPath();
  ctx.ellipse(0, bottomY, radius, height, 0, 0, 2 * Math.PI);
  ctx.fill(); ctx.stroke();
  ctx.fillRect(-radius, topY, radius * 2, bottomY - topY);
  ctx.beginPath();
  ctx.moveTo(-radius, topY); ctx.lineTo(-radius, bottomY);
  ctx.moveTo(radius, topY); ctx.lineTo(radius, bottomY);
  ctx.stroke();
  ctx.beginPath();
  ctx.ellipse(0, topY, radius, height, 0, 0, 2 * Math.PI);
  ctx.fill(); ctx.stroke();
};

Disk.prototype.setTarget = function() {
  this.targetX = pegX[this.peg];
  this.targetY = (pegs[this.peg].indexOf(this)) * DISK_THICKNESS;
  if (this.x === undefined) { this.x = this.targetX; }
  this.sourceX = this.x;
  if (this.y === undefined) { this.y = this.targetY; }
  this.sourceY = this.y;
  if (this.isRaised) {
    this.targetY += RAISE_HEIGHT;
  }
};

function drawSpot() {
  var radius = CANVAS_WIDTH / 7;
  var pitchRadians = VIEW_ANGLE / 180 * Math.PI;
  var ratio = Math.sin(pitchRadians);
  var height = Math.abs(radius * ratio);
  var halfVisualThickness = Math.cos(pitchRadians) * ((DISK_THICKNESS - 1) / 2);
  var bottomY = halfVisualThickness;
  ctx.strokeStyle = 'rgba(255,255,255,0.2)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.ellipse(0, bottomY, radius, height, 0, 0, 2 * Math.PI);
  ctx.stroke();
};

// --- FULLSCREEN LOGIC ---
function toggleFullscreen() {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
            alert(`Tam ekran modu etkinleştirilemedi: ${err.message} (${err.name})`);
        });
    } else {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        }
    }
}

function updateFullscreenIcon() {
    if (document.fullscreenElement) {
        iconExpand.style.display = 'none';
        iconCompress.style.display = 'block';
    } else {
        iconExpand.style.display = 'block';
        iconCompress.style.display = 'none';
    }
}

// --- CLIPBOARD LOGIC ---
async function copyToClipboard(text) {
  try {
    if (navigator.clipboard && window.isSecureContext) {
      await navigator.clipboard.writeText(text);
      return true;
    } else {
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.setAttribute('readonly', '');
      ta.style.position = 'fixed'; ta.style.top = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      const ok = document.execCommand('copy');
      document.body.removeChild(ta);
      return ok;
    }
  } catch (e) {
    console.warn('Clipboard failed:', e);
    return false;
  }
}

async function handleCopy() {
    const textToCopy = (pwdEl.textContent || '').trim();
    if (!textToCopy || textToCopy === '—') return;
    const ok = await copyToClipboard(textToCopy);
    copyBtn.textContent = ok ? '✅ Kopyalandı' : '❌ Hata';
    setTimeout(() => copyBtn.textContent = '📋 Kopyala', 1500);
}
</script>
</body>
</html>
